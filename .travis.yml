# General settings
dist: trusty
sudo: false
language: node_js
node_js:
  "lts/*"
cache:
  directories:
    - node_modules
notifications:
  email: false
branches:
  only:
    - master
    - develop

# Build stages
stages:
  - name: build
  - name: test (Angular 4)
  - name: test (Angular 5)
  - name: test (Angular 6)
  - name: release
    if: branch = master

# Build jobs
jobs:
  include:

    - stage: build
      before_install:
        - npm install -g npm
      install:
        - npm ci
      script:
        - npm run build

    - stage: test (Angular 4)
      env:
        - ANGULAR=4.0.x
        - TYPESCRIPT=2.1.x
      before_install:
        - npm install -g npm
      install:
        - npm ci
      before_script:
        - npm run build
        - rimraf -r node_modules/**
        - cd test/my-library
        - npm install $( npm pack ../../dist | tail -1 ) @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR typescript@$TYPESCRIPT rxjs@5.5.x copyfiles --no-save --no-package-lock
        - npm run build:lib
        - cd ../my-app
        - npm install @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR @angular/platform-browser@$ANGULAR @angular/platform-browser-dynamic@$ANGULAR typescript@$TYPESCRIPT @angular/cli@1.4.x rxjs@5.5.x zone.js@0.8.x --no-save --no-package-lock
        - cd ../..
        - npm ci
      script:
        - npm run test:package
        - cd test/my-app && npm install ../my-library/dist --no-save --no-package-lock && cd ../.. && rimraf -r node_modules/**
        - npm run test:integration
    -
      env:
        - ANGULAR=4.0.x
        - TYPESCRIPT=2.2.x
      before_install:
        - npm install -g npm
      install:
        - npm ci
      before_script:
        - npm run build
        - rimraf -r node_modules/**
        - cd test/my-library
        - npm install $( npm pack ../../dist | tail -1 ) @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR typescript@$TYPESCRIPT rxjs@5.5.x copyfiles --no-save --no-package-lock
        - npm run build:lib
        - cd ../my-app
        - npm install @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR @angular/platform-browser@$ANGULAR @angular/platform-browser-dynamic@$ANGULAR typescript@$TYPESCRIPT @angular/cli@1.4.x rxjs@5.5.x zone.js@0.8.x --no-save --no-package-lock
        - cd ../..
        - npm ci
      script:
        - npm run test:package
        - cd test/my-app && npm install ../my-library/dist --no-save --no-package-lock && cd ../.. && rimraf -r node_modules/**
        - npm run test:integration
    -
      env:
        - ANGULAR=4.0.x
        - TYPESCRIPT=2.3.x
      before_install:
        - npm install -g npm
      install:
        - npm ci
      before_script:
        - npm run build
        - rimraf -r node_modules/**
        - cd test/my-library
        - npm install $( npm pack ../../dist | tail -1 ) @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR typescript@$TYPESCRIPT rxjs@5.5.x copyfiles --no-save --no-package-lock
        - npm run build:lib
        - cd ../my-app
        - npm install @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR @angular/platform-browser@$ANGULAR @angular/platform-browser-dynamic@$ANGULAR typescript@$TYPESCRIPT @angular/cli@1.4.x rxjs@5.5.x zone.js@0.8.x --no-save --no-package-lock
        - cd ../..
        - npm ci
      script:
        - npm run test:package
        - cd test/my-app && npm install ../my-library/dist --no-save --no-package-lock && cd ../.. && rimraf -r node_modules/**
        - npm run test:integration
    -
      env:
        - ANGULAR=4.1.x
        - TYPESCRIPT=2.1.x
      before_install:
        - npm install -g npm
      install:
        - npm ci
      before_script:
        - npm run build
        - rimraf -r node_modules/**
        - cd test/my-library
        - npm install $( npm pack ../../dist | tail -1 ) @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR typescript@$TYPESCRIPT rxjs@5.5.x copyfiles --no-save --no-package-lock
        - npm run build:lib
        - cd ../my-app
        - npm install @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR @angular/platform-browser@$ANGULAR @angular/platform-browser-dynamic@$ANGULAR typescript@$TYPESCRIPT @angular/cli@1.4.x rxjs@5.5.x zone.js@0.8.x --no-save --no-package-lock
        - cd ../..
        - npm ci
      script:
        - npm run test:package
        - cd test/my-app && npm install ../my-library/dist --no-save --no-package-lock && cd ../.. && rimraf -r node_modules/**
        - npm run test:integration
    -
      env:
        - ANGULAR=4.1.x
        - TYPESCRIPT=2.2.x
      before_install:
        - npm install -g npm
      install:
        - npm ci
      before_script:
        - npm run build
        - rimraf -r node_modules/**
        - cd test/my-library
        - npm install $( npm pack ../../dist | tail -1 ) @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR typescript@$TYPESCRIPT rxjs@5.5.x copyfiles --no-save --no-package-lock
        - npm run build:lib
        - cd ../my-app
        - npm install @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR @angular/platform-browser@$ANGULAR @angular/platform-browser-dynamic@$ANGULAR typescript@$TYPESCRIPT @angular/cli@1.4.x rxjs@5.5.x zone.js@0.8.x --no-save --no-package-lock
        - cd ../..
        - npm ci
      script:
        - npm run test:package
        - cd test/my-app && npm install ../my-library/dist --no-save --no-package-lock && cd ../.. && rimraf -r node_modules/**
        - npm run test:integration
    -
      env:
        - ANGULAR=4.1.x
        - TYPESCRIPT=2.3.x
      before_install:
        - npm install -g npm
      install:
        - npm ci
      before_script:
        - npm run build
        - rimraf -r node_modules/**
        - cd test/my-library
        - npm install $( npm pack ../../dist | tail -1 ) @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR typescript@$TYPESCRIPT rxjs@5.5.x copyfiles --no-save --no-package-lock
        - npm run build:lib
        - cd ../my-app
        - npm install @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR @angular/platform-browser@$ANGULAR @angular/platform-browser-dynamic@$ANGULAR typescript@$TYPESCRIPT @angular/cli@1.4.x rxjs@5.5.x zone.js@0.8.x --no-save --no-package-lock
        - cd ../..
        - npm ci
      script:
        - npm run test:package
        - cd test/my-app && npm install ../my-library/dist --no-save --no-package-lock && cd ../.. && rimraf -r node_modules/**
        - npm run test:integration
    -
      env:
        - ANGULAR=4.2.x
        - TYPESCRIPT=2.1.x
      before_install:
        - npm install -g npm
      install:
        - npm ci
      before_script:
        - npm run build
        - rimraf -r node_modules/**
        - cd test/my-library
        - npm install $( npm pack ../../dist | tail -1 ) @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR typescript@$TYPESCRIPT rxjs@5.5.x copyfiles --no-save --no-package-lock
        - npm run build:lib
        - cd ../my-app
        - npm install @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR @angular/platform-browser@$ANGULAR @angular/platform-browser-dynamic@$ANGULAR typescript@$TYPESCRIPT @angular/cli@1.4.x rxjs@5.5.x zone.js@0.8.x --no-save --no-package-lock
        - cd ../..
        - npm ci
      script:
        - npm run test:package
        - cd test/my-app && npm install ../my-library/dist --no-save --no-package-lock && cd ../.. && rimraf -r node_modules/**
        - npm run test:integration
    -
      env:
        - ANGULAR=4.2.x
        - TYPESCRIPT=2.2.x
      before_install:
        - npm install -g npm
      install:
        - npm ci
      before_script:
        - npm run build
        - rimraf -r node_modules/**
        - cd test/my-library
        - npm install $( npm pack ../../dist | tail -1 ) @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR typescript@$TYPESCRIPT rxjs@5.5.x copyfiles --no-save --no-package-lock
        - npm run build:lib
        - cd ../my-app
        - npm install @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR @angular/platform-browser@$ANGULAR @angular/platform-browser-dynamic@$ANGULAR typescript@$TYPESCRIPT @angular/cli@1.4.x rxjs@5.5.x zone.js@0.8.x --no-save --no-package-lock
        - cd ../..
        - npm ci
      script:
        - npm run test:package
        - cd test/my-app && npm install ../my-library/dist --no-save --no-package-lock && cd ../.. && rimraf -r node_modules/**
        - npm run test:integration
    -
      env:
        - ANGULAR=4.2.x
        - TYPESCRIPT=2.3.x
      before_install:
        - npm install -g npm
      install:
        - npm ci
      before_script:
        - npm run build
        - rimraf -r node_modules/**
        - cd test/my-library
        - npm install $( npm pack ../../dist | tail -1 ) @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR typescript@$TYPESCRIPT rxjs@5.5.x copyfiles --no-save --no-package-lock
        - npm run build:lib
        - cd ../my-app
        - npm install @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR @angular/platform-browser@$ANGULAR @angular/platform-browser-dynamic@$ANGULAR typescript@$TYPESCRIPT @angular/cli@1.4.x rxjs@5.5.x zone.js@0.8.x --no-save --no-package-lock
        - cd ../..
        - npm ci
      script:
        - npm run test:package
        - cd test/my-app && npm install ../my-library/dist --no-save --no-package-lock && cd ../.. && rimraf -r node_modules/**
        - npm run test:integration
    -
      env:
        - ANGULAR=4.3.x
        - TYPESCRIPT=2.1.x
      before_install:
        - npm install -g npm
      install:
        - npm ci
      before_script:
        - npm run build
        - rimraf -r node_modules/**
        - cd test/my-library
        - npm install $( npm pack ../../dist | tail -1 ) @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR typescript@$TYPESCRIPT rxjs@5.5.x copyfiles --no-save --no-package-lock
        - npm run build:lib
        - cd ../my-app
        - npm install @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR @angular/platform-browser@$ANGULAR @angular/platform-browser-dynamic@$ANGULAR typescript@$TYPESCRIPT @angular/cli@1.4.x rxjs@5.5.x zone.js@0.8.x --no-save --no-package-lock
        - cd ../..
        - npm ci
      script:
        - npm run test:package
        - cd test/my-app && npm install ../my-library/dist --no-save --no-package-lock && cd ../.. && rimraf -r node_modules/**
        - npm run test:integration
    -
      env:
        - ANGULAR=4.3.x
        - TYPESCRIPT=2.2.x
      before_install:
        - npm install -g npm
      install:
        - npm ci
      before_script:
        - npm run build
        - rimraf -r node_modules/**
        - cd test/my-library
        - npm install $( npm pack ../../dist | tail -1 ) @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR typescript@$TYPESCRIPT rxjs@5.5.x copyfiles --no-save --no-package-lock
        - npm run build:lib
        - cd ../my-app
        - npm install @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR @angular/platform-browser@$ANGULAR @angular/platform-browser-dynamic@$ANGULAR typescript@$TYPESCRIPT @angular/cli@1.4.x rxjs@5.5.x zone.js@0.8.x --no-save --no-package-lock
        - cd ../..
        - npm ci
      script:
        - npm run test:package
        - cd test/my-app && npm install ../my-library/dist --no-save --no-package-lock && cd ../.. && rimraf -r node_modules/**
        - npm run test:integration
    -
      env:
        - ANGULAR=4.3.x
        - TYPESCRIPT=2.3.x
      before_install:
        - npm install -g npm
      install:
        - npm ci
      before_script:
        - npm run build
        - rimraf -r node_modules/**
        - cd test/my-library
        - npm install $( npm pack ../../dist | tail -1 ) @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR typescript@$TYPESCRIPT rxjs@5.5.x copyfiles --no-save --no-package-lock
        - npm run build:lib
        - cd ../my-app
        - npm install @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR @angular/platform-browser@$ANGULAR @angular/platform-browser-dynamic@$ANGULAR typescript@$TYPESCRIPT @angular/cli@1.4.x rxjs@5.5.x zone.js@0.8.x --no-save --no-package-lock
        - cd ../..
        - npm ci
      script:
        - npm run test:package
        - cd test/my-app && npm install ../my-library/dist --no-save --no-package-lock && cd ../.. && rimraf -r node_modules/**
        - npm run test:integration
    -
      env:
        - ANGULAR=4.4.x
        - TYPESCRIPT=2.1.x
      before_install:
        - npm install -g npm
      install:
        - npm ci
      before_script:
        - npm run build
        - rimraf -r node_modules/**
        - cd test/my-library
        - npm install $( npm pack ../../dist | tail -1 ) @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR typescript@$TYPESCRIPT rxjs@5.5.x copyfiles --no-save --no-package-lock
        - npm run build:lib
        - cd ../my-app
        - npm install @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR @angular/platform-browser@$ANGULAR @angular/platform-browser-dynamic@$ANGULAR typescript@$TYPESCRIPT @angular/cli@1.4.x rxjs@5.5.x zone.js@0.8.x --no-save --no-package-lock
        - cd ../..
        - npm ci
      script:
        - npm run test:package
        - cd test/my-app && npm install ../my-library/dist --no-save --no-package-lock && cd ../.. && rimraf -r node_modules/**
        - npm run test:integration
    -
      env:
        - ANGULAR=4.4.x
        - TYPESCRIPT=2.2.x
      before_install:
        - npm install -g npm
      install:
        - npm ci
      before_script:
        - npm run build
        - rimraf -r node_modules/**
        - cd test/my-library
        - npm install $( npm pack ../../dist | tail -1 ) @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR typescript@$TYPESCRIPT rxjs@5.5.x copyfiles --no-save --no-package-lock
        - npm run build:lib
        - cd ../my-app
        - npm install @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR @angular/platform-browser@$ANGULAR @angular/platform-browser-dynamic@$ANGULAR typescript@$TYPESCRIPT @angular/cli@1.4.x rxjs@5.5.x zone.js@0.8.x --no-save --no-package-lock
        - cd ../..
        - npm ci
      script:
        - npm run test:package
        - cd test/my-app && npm install ../my-library/dist --no-save --no-package-lock && cd ../.. && rimraf -r node_modules/**
        - npm run test:integration
    -
      env:
        - ANGULAR=4.4.x
        - TYPESCRIPT=2.3.x
      before_install:
        - npm install -g npm
      install:
        - npm ci
      before_script:
        - npm run build
        - rimraf -r node_modules/**
        - cd test/my-library
        - npm install $( npm pack ../../dist | tail -1 ) @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR typescript@$TYPESCRIPT rxjs@5.5.x copyfiles --no-save --no-package-lock
        - npm run build:lib
        - cd ../my-app
        - npm install @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR @angular/platform-browser@$ANGULAR @angular/platform-browser-dynamic@$ANGULAR typescript@$TYPESCRIPT @angular/cli@1.4.x rxjs@5.5.x zone.js@0.8.x --no-save --no-package-lock
        - cd ../..
        - npm ci
      script:
        - npm run test:package
        - cd test/my-app && npm install ../my-library/dist --no-save --no-package-lock && cd ../.. && rimraf -r node_modules/**
        - npm run test:integration

    - stage: test (Angular 5)
      env:
        - ANGULAR=5.0.x
        - TYPESCRIPT=2.4.x
      before_install:
        - npm install -g npm
      install:
        - npm ci
      before_script:
        - npm run build
        - rimraf -r node_modules/**
        - cd test/my-library
        - npm install $( npm pack ../../dist | tail -1 ) @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR typescript@$TYPESCRIPT rxjs@5.5.x copyfiles --no-save --no-package-lock
        - npm run build:lib
        - cd ../my-app
        - npm install @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR @angular/platform-browser@$ANGULAR @angular/platform-browser-dynamic@$ANGULAR typescript@$TYPESCRIPT @angular/cli@1.7.x rxjs@5.5.x zone.js@0.8.x --no-save --no-package-lock
        - cd ../..
        - npm ci
      script:
        - npm run test:package
        - cd test/my-app && npm install ../my-library/dist --no-save --no-package-lock && cd ../.. && rimraf -r node_modules/**
        - npm run test:integration
    -
      env:
        - ANGULAR=5.1.x
        - TYPESCRIPT=2.4.x
      before_install:
        - npm install -g npm
      install:
        - npm ci
      before_script:
        - npm run build
        - rimraf -r node_modules/**
        - cd test/my-library
        - npm install $( npm pack ../../dist | tail -1 ) @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR typescript@$TYPESCRIPT rxjs@5.5.x copyfiles --no-save --no-package-lock
        - npm run build:lib
        - cd ../my-app
        - npm install @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR @angular/platform-browser@$ANGULAR @angular/platform-browser-dynamic@$ANGULAR typescript@$TYPESCRIPT @angular/cli@1.7.x rxjs@5.5.x zone.js@0.8.x --no-save --no-package-lock
        - cd ../..
        - npm ci
      script:
        - npm run test:package
        - cd test/my-app && npm install ../my-library/dist --no-save --no-package-lock && cd ../.. && rimraf -r node_modules/**
        - npm run test:integration
    -
      env:
        - ANGULAR=5.1.x
        - TYPESCRIPT=2.5.x
      before_install:
        - npm install -g npm
      install:
        - npm ci
      before_script:
        - npm run build
        - rimraf -r node_modules/**
        - cd test/my-library
        - npm install $( npm pack ../../dist | tail -1 ) @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR typescript@$TYPESCRIPT rxjs@5.5.x copyfiles --no-save --no-package-lock
        - npm run build:lib
        - cd ../my-app
        - npm install @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR @angular/platform-browser@$ANGULAR @angular/platform-browser-dynamic@$ANGULAR typescript@$TYPESCRIPT @angular/cli@1.7.x rxjs@5.5.x zone.js@0.8.x --no-save --no-package-lock
        - cd ../..
        - npm ci
      script:
        - npm run test:package
        - cd test/my-app && npm install ../my-library/dist --no-save --no-package-lock && cd ../.. && rimraf -r node_modules/**
        - npm run test:integration
    -
      env:
        - ANGULAR=5.2.x
        - TYPESCRIPT=2.4.x
      before_install:
        - npm install -g npm
      install:
        - npm ci
      before_script:
        - npm run build
        - rimraf -r node_modules/**
        - cd test/my-library
        - npm install $( npm pack ../../dist | tail -1 ) @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR typescript@$TYPESCRIPT rxjs@5.5.x copyfiles --no-save --no-package-lock
        - npm run build:lib
        - cd ../my-app
        - npm install @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR @angular/platform-browser@$ANGULAR @angular/platform-browser-dynamic@$ANGULAR typescript@$TYPESCRIPT @angular/cli@1.7.x rxjs@5.5.x zone.js@0.8.x --no-save --no-package-lock
        - cd ../..
        - npm ci
      script:
        - npm run test:package
        - cd test/my-app && npm install ../my-library/dist --no-save --no-package-lock && cd ../.. && rimraf -r node_modules/**
        - npm run test:integration
    -
      env:
        - ANGULAR=5.2.x
        - TYPESCRIPT=2.5.x
      before_install:
        - npm install -g npm
      install:
        - npm ci
      before_script:
        - npm run build
        - rimraf -r node_modules/**
        - cd test/my-library
        - npm install $( npm pack ../../dist | tail -1 ) @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR typescript@$TYPESCRIPT rxjs@5.5.x copyfiles --no-save --no-package-lock
        - npm run build:lib
        - cd ../my-app
        - npm install @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR @angular/platform-browser@$ANGULAR @angular/platform-browser-dynamic@$ANGULAR typescript@$TYPESCRIPT @angular/cli@1.7.x rxjs@5.5.x zone.js@0.8.x --no-save --no-package-lock
        - cd ../..
        - npm ci
      script:
        - npm run test:package
        - cd test/my-app && npm install ../my-library/dist --no-save --no-package-lock && cd ../.. && rimraf -r node_modules/**
        - npm run test:integration
    -
      env:
        - ANGULAR=5.2.x
        - TYPESCRIPT=2.6.x
      before_install:
        - npm install -g npm
      install:
        - npm ci
      before_script:
        - npm run build
        - rimraf -r node_modules/**
        - cd test/my-library
        - npm install $( npm pack ../../dist | tail -1 ) @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR typescript@$TYPESCRIPT rxjs@5.5.x copyfiles --no-save --no-package-lock
        - npm run build:lib
        - cd ../my-app
        - npm install @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR @angular/platform-browser@$ANGULAR @angular/platform-browser-dynamic@$ANGULAR typescript@$TYPESCRIPT @angular/cli@1.7.x rxjs@5.5.x zone.js@0.8.x --no-save --no-package-lock
        - cd ../..
        - npm ci
      script:
        - npm run test:package
        - cd test/my-app && npm install ../my-library/dist --no-save --no-package-lock && cd ../.. && rimraf -r node_modules/**
        - npm run test:integration

    - stage: test (Angular 6)
      env:
        - ANGULAR=6.0.x
        - TYPESCRIPT=2.7.x
      before_install:
        - npm install -g npm
      install:
        - npm ci
      before_script:
        - npm run build
        - rimraf -r node_modules/**
        - cd test/my-library
        - npm install $( npm pack ../../dist | tail -1 ) @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR typescript@$TYPESCRIPT rxjs@6.0.x copyfiles --no-save --no-package-lock
        - npm run build:lib
        - cd ../my-app
        - npm install @angular/compiler@$ANGULAR @angular/compiler-cli@$ANGULAR @angular/core@$ANGULAR @angular/common@$ANGULAR @angular/platform-browser@$ANGULAR @angular/platform-browser-dynamic@$ANGULAR typescript@$TYPESCRIPT @angular/cli@1.7.x rxjs@5.5.x zone.js@0.8.x --no-save --no-package-lock
        - cd ../..
        - npm ci
      script:
        - npm run test:package
        - cd test/my-app && npm install ../my-library/dist --no-save --no-package-lock && cd ../.. && rimraf -r node_modules/**
        - npm run test:integration

    - stage: release
      node_js:
        - "lts/*"
      before_install:
        # Clone the whole repository because we also need the develop branch for releasing (Travis only gives us the master by default)
        - git clone "https://github.com/$TRAVIS_REPO_SLUG.git" "$TRAVIS_REPO_SLUG";
        - cd "$TRAVIS_REPO_SLUG";
        - git checkout -qf "$TRAVIS_COMMIT";
        #  Fix Travis CI issue of detached heads in git
        - git checkout master
      before_install:
        - npm install -g npm
      install:
        - npm ci
      script:
        - npm run build
      before_deploy:
        # Login to Git to be able to make commits (required by automatic-release)
        - git config --global user.name "dominique-mueller";
        - git config --global user.email "dominique.m.mueller@gmail.com";
        - git config credential.helper "store --file=.git/credentials";
        - echo "https://$GH_TOKEN:@github.com" > .git/credentials;
        # Do release
        - npm run release
        # Publish the dist folder
        - cd dist
      deploy:
        provider: npm
        email: dominique.m.mueller@gmail.com
        api_key: "$NPM_TOKEN"
        skip_cleanup: true
      after_deploy:
        - cd ..
